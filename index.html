<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Ma SÃ³i Host Mobile</title>

<style>
  body {
    margin:0;
    background:#0a0f17;
    color:#fff;
    font-family:Arial, sans-serif;
  }

  .container {
    max-width:430px;
    margin:auto;
    padding:10px 14px;
  }

  h2 {
    font-size:18px;
    margin-top:12px;
    margin-bottom:6px;
  }

  input, select {
    width:100%;
    padding:10px;
    margin:5px 0;
    border-radius:8px;
    border:none;
    font-size:15px;
    background:#151b25;
    color:#fff;
  }

  button {
    width:100%;
    padding:12px;
    margin:6px 0;
    font-size:16px;
    border-radius:8px;
    border:none;
    font-weight:bold;
    color:#fff;
  }

  .btn-primary {
    background:#1abc9c;
  }
  .btn-secondary {
    background:#34495e;
  }
  .btn-danger {
    background:#e74c3c;
  }

  .player-card {
    background:#111621;
    margin-top:6px;
    padding:10px;
    border-radius:8px;
    font-size:14px;
  }

  .status {
    font-size:12px;
    opacity:.7;
  }

  #log-box {
    background:#0f141d;
    padding:10px;
    border-radius:8px;
    height:200px;
    overflow-y:auto;
    font-size:13px;
    margin-top:10px;
  }

  .log-line {
    border-bottom:1px dotted #333;
    padding:3px 0;
  }
</style>
</head>

<body>
<div class="container">

<h2>ThÃªm ngÆ°á»i chÆ¡i</h2>
<input id="name" placeholder="TÃªn ngÆ°á»i chÆ¡i">
<select id="role"></select>
<button class="btn-secondary" onclick="addPlayer()">ThÃªm ngÆ°á»i</button>

<button class="btn-primary" onclick="startGame()">ğŸŒ™ Báº¯t Ä‘áº§u vÃ¡n</button>

<h2>NgÆ°á»i chÆ¡i</h2>
<div id="players"></div>

<h2>Äiá»u khiá»ƒn</h2>
<button class="btn-secondary" onclick="nextRole()">ğŸ“£ Gá»i role</button>
<button class="btn-secondary" onclick="startDay()">â˜€ï¸ Báº¯t Ä‘áº§u ngÃ y</button>
<button class="btn-secondary" onclick="startNight()">ğŸŒ™ Báº¯t Ä‘áº§u Ä‘Ãªm</button>
<button class="btn-danger" onclick="resetAll()">XÃ³a vÃ¡n</button>

<h2>Log</h2>
<div id="log-box"></div>

</div>

<script>
const ROLES = [
  {id:"werewolf",label:"ğŸº SÃ³i"},
  {id:"seer",label:"ğŸ”® TiÃªn tri"},
  {id:"witch",label:"ğŸ§ª PhÃ¹ thá»§y"},
  {id:"guard",label:"ğŸ›¡ï¸ Báº£o vá»‡"},
  {id:"mage",label:"ğŸ§™ PhÃ¡p sÆ°"},
  {id:"gambler",label:"ğŸ² Con báº¡c"},
  {id:"prince",label:"ğŸ‘‘ HoÃ ng tá»­"},
  {id:"villager",label:"ğŸ‘¤ DÃ¢n lÃ ng"}
];

const ORDER = ["mage","werewolf","seer","witch","guard","gambler","prince"];

let state = {
  players:[],
  phase:"setup",
  night:1,
  step:0,
  logs:[],
  witchUsed:false,
  actions:{
    wolf:null,
    guard:null,
    witchHeal:false,
    witchPoison:null,
    mute:null,
    bet:null
  }
};

function log(t){
  state.logs.unshift(t);
  renderLogs();
}

function addPlayer(){
  let name=document.getElementById("name").value.trim();
  let role=document.getElementById("role").value;
  if(!name||!role) return alert("Nháº­p Ä‘áº§y Ä‘á»§");
  state.players.push({name,role,alive:true,muted:false});
  document.getElementById("name").value="";
  renderPlayers();
  log("â• "+name+" ("+role+")");
}

function startGame(){
  if(state.players.length<4) return alert("Cáº§n â‰¥ 4 ngÆ°á»i");
  state.phase="night";
  state.step=0;
  log("ğŸŒ™ ÄÃªm 1 báº¯t Ä‘áº§u");
  renderPlayers();
}

function startNight(){
  if(state.phase==="ended") return;
  state.phase="night";
  state.night++;
  state.step=0;
  state.players.forEach(p=>p.muted=false);
  state.actions={wolf:null,guard:null,witchHeal:false,witchPoison:null,mute:null,bet:null};
  log("ğŸŒ™ ÄÃªm "+state.night+" báº¯t Ä‘áº§u");
}

function startDay(){
  if(state.phase==="ended") return;
  state.phase="day";
  log("â˜€ï¸ Ban ngÃ y báº¯t Ä‘áº§u");
}

function nextRole(){
  if(state.phase!=="night") return alert("Role chá»‰ gá»i lÃºc ÄÃŠM");
  if(state.step>=ORDER.length){
    resolveNight();
    log("âœ” ÄÃªm káº¿t thÃºc");
    return;
  }
  let r=ORDER[state.step++];
  callRole(r);
}

function callRole(r){
  if(!state.players.some(p=>p.role===r&&p.alive)) return;
  log("ğŸ“£ Gá»i "+r);
  // (Panel input thá»±c táº¿ mÃ¬nh Ä‘Ã£ giáº£n lÆ°á»£c â€” báº¡n tick miá»‡ng,
  // app chá»‰ tracking log & xá»­ lÃ½ cháº¿t/sá»‘ng)
}

function resolveNight(){
  let deaths=[];
  function get(p){return state.players.find(x=>x.name===p&&x.alive);}
  let wolf=get(state.actions.wolf);
  let guard=get(state.actions.guard);
  let poison=get(state.actions.witchPoison);

  let potionUsed=false;

  if(wolf){
    if(guard===wolf){
      log("ğŸ›¡ï¸ Báº£o vá»‡ che cháº¯n "+wolf.name);
    }else if(!state.witchUsed && state.actions.witchHeal){
      potionUsed=true;
      log("ğŸ§ª PhÃ¹ thá»§y Cá»¨U "+wolf.name);
    }else{
      deaths.push(wolf);
      log("ğŸº SÃ³i giáº¿t "+wolf.name);
    }
  }

  if(!state.witchUsed && poison){
    deaths.push(poison);
    potionUsed=true;
    log("ğŸ’€ PhÃ¹ thá»§y Äá»˜C "+poison.name);
  }

  if(potionUsed){
    state.witchUsed=true;
    log("ğŸ§ª PhÃ¹ thá»§y Ä‘Ã£ háº¿t bÃ¬nh cho cáº£ game");
  }

  if(state.actions.mute){
    let m=get(state.actions.mute);
    if(m){ m.muted=true; log("ğŸ¤ "+m.name+" bá»‹ MUTE"); }
  }

  if(state.night>=2 && state.actions.bet){
    let g=state.players.find(p=>p.role==="gambler"&&p.alive);
    let t=get(state.actions.bet);
    if(g&&t){
      if(t.role==="werewolf"){
        deaths.push(t); log("ğŸ² Con báº¡c Ä‘oÃ¡n TRÃšNG SÃ³i!");
      }else{
        deaths.push(g); log("ğŸ² Con báº¡c Ä‘oÃ¡n sai -> cháº¿t");
      }
    }
  }

  deaths.forEach(p=>{ p.alive=false });
  renderPlayers();
}

function renderPlayers(){
  let box=document.getElementById("players");
  box.innerHTML="";
  state.players.forEach(p=>{
    let div=document.createElement("div");
    div.className="player-card";
    div.innerHTML=`
      <b>${p.name}</b> â€” ${p.role}
      <div class="status">${p.alive?"âœ” sá»‘ng":"â˜  cháº¿t"} ${p.muted?"ğŸ¤ mute":""}</div>
    `;
    box.appendChild(div);
  });
}

function renderLogs(){
  let box=document.getElementById("log-box");
  box.innerHTML="";
  state.logs.forEach(l=>{
    let d=document.createElement("div");
    d.className="log-line";
    d.textContent=l;
    box.appendChild(d);
  });
}

function resetAll(){
  if(!confirm("Reset vÃ¡n?")) return;
  state={
    players:[],
    phase:"setup",
    night:1,
    step:0,
    logs:[],
    witchUsed:false,
    actions:{wolf:null,guard:null,witchHeal:false,witchPoison:null,mute:null,bet:null}
  };
  renderPlayers(); renderLogs();
  log("â™» Reset xong");
}

ROLES.forEach(r=>{
  let o=document.createElement("option");
  o.value=r.id; o.textContent=r.label;
  document.getElementById("role").appendChild(o);
});
</script>

</body>
</html>
